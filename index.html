<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Grow Mastery: Potatoes, Cauliflower, Broccoli, Radish, Lettuce</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0f172a;          /* slate-900 */
      --panel:#111827;       /* gray-900 */
      --ink:#e5e7eb;         /* gray-200 */
      --muted:#9ca3af;       /* gray-400 */
      --brand:#22d3ee;       /* cyan-400 */
      --accent:#a78bfa;      /* violet-400 */
      --ok:#34d399;          /* emerald-400 */
      --warn:#f59e0b;        /* amber-500 */
      --danger:#f87171;      /* red-400 */
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background: radial-gradient(1200px 700px at 10% -10%, #1f2937 0%, #0b1022 60%, #070b18 100%);
      color:var(--ink); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      line-height:1.55;
    }
    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(8px);
      background: linear-gradient(180deg, rgba(15,23,42,.9), rgba(15,23,42,.65) 70%, rgba(15,23,42,0));
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .wrap{max-width:1200px;margin:0 auto;padding:16px 20px}
    .hero{
      display:flex; align-items:center; gap:16px; padding:8px 0 10px 0;
    }
    .logo{
      width:44px; height:44px; border-radius:12px;
      background: conic-gradient(from 220deg, var(--brand), var(--accent), var(--brand));
      box-shadow: inset 0 0 30px rgba(255,255,255,.25), var(--shadow);
      display:grid; place-items:center; font-weight:900; color:#06121a;
    }
    .hero h1{margin:0;font-size: clamp(18px, 2.2vw, 26px)}
    .hero p{margin:0;color:var(--muted);font-size:14px}
    .bar{
      height:8px; border-radius:999px; background:rgba(255,255,255,.08); overflow:hidden;
      margin-top:10px; position:relative;
    }
    .bar > span{
      display:block; height:100%; width:0%;
      background: linear-gradient(90deg, var(--brand), var(--accent));
      transition: width .4s ease;
    }
    .levels{
      display:flex; gap:8px; margin-top:8px; align-items:center; flex-wrap:wrap
    }
    .pill{padding:6px 10px; border-radius:999px; background: rgba(255,255,255,.06); font-size:12px}
    .pill.active{background: linear-gradient(90deg, rgba(34,211,238,.18), rgba(167,139,250,.18)); border:1px solid rgba(167,139,250,.35)}
    main{max-width:1200px;margin:24px auto; padding:0 20px; display:grid; grid-template-columns: 290px 1fr; gap:20px}
    @media (max-width: 980px){ main{grid-template-columns:1fr}}
    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
      border:1px solid rgba(255,255,255,.08); border-radius: var(--radius); box-shadow: var(--shadow)
    }
    .side{padding:16px}
    .grid{display:grid; gap:10px}
    .plant-btn{
      display:flex; align-items:center; gap:10px; padding:10px 12px; cursor:pointer;
      background: rgba(255,255,255,.04); border:1px solid transparent; border-radius:12px;
      transition: transform .05s ease, border-color .2s ease, background .2s ease;
      color: var(--ink); /* Ensure all text inherits white color */
    }
    .plant-btn:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.16)}
    .plant-btn.active{outline:2px solid rgba(34,211,238,.35); background: linear-gradient(90deg, rgba(34,211,238,.1), rgba(167,139,250,.08))}
    .emoji{font-size:20px}
    .content{padding:18px}
    .title-row{display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap}
    .title-row h2{margin:0; font-size: clamp(18px,2.2vw,24px)}
    .tag{font-size:12px; padding:6px 10px; border-radius:999px; color:#0c1a13; background: linear-gradient(90deg, #9ae6b4, #34d399)}
    .pricebox{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:8px
    }
    .pricebox input, .pricebox select{
      background: rgba(255,255,255,.06); color: var(--ink);
      border:1px solid rgba(255,255,255,.12); padding:8px 10px; border-radius:10px;
      width:auto; min-width:90px; font-size:14px;
    }
    .bignum{font-size:22px; font-weight:800}
    .muted{color:var(--muted)}
    .row{display:grid; grid-template-columns:1.2fr .8fr; gap:16px; margin-top:16px}
    @media (max-width: 980px){ .row{grid-template-columns:1fr}}
    .card{padding:14px 14px; border-radius:14px; border:1px solid rgba(255,255,255,.08); background: rgba(255,255,255,.03)}
    .card h3{margin:0 0 8px 0; font-size:16px}
    .steps{display:grid; gap:8px}
    details{
      border:1px solid rgba(255,255,255,.08); border-radius:12px; overflow:hidden;
      background: rgba(255,255,255,.02)
    }
    summary{
      list-style:none; cursor:pointer; padding:12px 14px; display:flex; align-items:center; justify-content:space-between; gap:8px
    }
    summary::-webkit-details-marker{display:none}
    .step-title{display:flex; gap:10px; align-items:center}
    .chip{font-size:12px; padding:4px 8px; border-radius:999px; background: rgba(255,255,255,.06)}
    .actions{display:flex; gap:8px; align-items:center; flex-wrap:wrap; padding:0 14px 14px 14px}
    .btn{
      padding:8px 10px; border-radius:10px; background: linear-gradient(90deg, rgba(34,211,238,.18), rgba(167,139,250,.18));
      border:1px solid rgba(255,255,255,.14); color:var(--ink); cursor:pointer; font-weight:600
    }
    .btn.secondary{background: rgba(255,255,255,.05)}
    .btn.danger{background: rgba(248,113,113,.12); border-color: rgba(248,113,113,.3)}
    .btn:disabled{opacity:.5; cursor:not-allowed}
    .tiny{font-size:12px}
    .ipm{
      display:grid; gap:8px; margin-top:8px
    }
    .ipm li{margin-left:18px}
    .good{color:var(--ok)}
    .warn{color:var(--warn)}
    .bad{color:var(--danger)}
    .timeline{
      display:grid; grid-template-columns: repeat(5, 1fr); gap:10px; margin-top:12px
    }
    .node{
      background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
      padding:10px; border-radius:12px; text-align:center; font-size:12px
    }
    .node.active{background: linear-gradient(180deg, rgba(34,211,238,.18), rgba(167,139,250,.18)); border-color: rgba(167,139,250,.45)}
    .hint{font-size:12px; color:var(--muted)}
    .footer{
      padding:14px; text-align:center; color:var(--muted); font-size:12px
    }
    .confetti{
      position: fixed; inset:0; pointer-events:none; z-index:9999; overflow:hidden;
    }
    .piece{
      position:absolute; width:10px; height:18px; opacity:.9;
      animation: fall 1200ms cubic-bezier(.2,.6,.2,1) forwards;
    }
    @keyframes fall{
      0% { transform: translateY(-10vh) rotate(0deg) }
      100% { transform: translateY(100vh) rotate(720deg) }
    }
    .toolbar{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:10px
    }
    .switch{ display:inline-flex; align-items:center; gap:8px }
    .switch input{ appearance:none; width:38px; height:22px; background: rgba(255,255,255,.2); border-radius:999px; position:relative; outline:none; cursor:pointer; transition: .2s }
    .switch input:checked{ background: linear-gradient(90deg, rgba(34,211,238,.6), rgba(167,139,250,.6)) }
    .switch input::after{
      content:""; position:absolute; top:3px; left:3px; width:16px; height:16px; border-radius:50%;
      background:#0b1022; transition: .2s
    }
    .switch input:checked::after{ left:19px }
  </style>
</head>
<body>

  <header>
    <div class="wrap">
      <div class="hero">
        <div class="logo">ðŸŒ±</div>
        <div style="flex:1">
          <h1>Grow Mastery: From seed to harvest</h1>
          <p>Interactive, level-based guide for Potatoes, Cauliflower, Broccoli, Radish, and Lettuce.</p>
          <div class="bar" aria-label="Overall progress">
            <span id="overallBar"></span>
          </div>
          <div class="levels" id="overallLevels">
            <span class="pill">Level 1: Seed</span>
            <span class="pill">Level 2: Establish</span>
            <span class="pill">Level 3: Grow</span>
            <span class="pill">Level 4: Bulk/Head</span>
            <span class="pill">Level 5: Harvest</span>
          </div>
        </div>
      </div>
      <div class="toolbar">
        <div class="switch">
          <label class="tiny muted">Show advanced tips</label>
          <input id="toggleAdvanced" type="checkbox" />
        </div>
        <button class="btn secondary tiny" id="resetAll">Reset all progress</button>
      </div>
    </div>
  </header>

  <main>
    <!-- LEFT: Plant selector -->
    <aside class="panel side">
      <h3 style="margin-top:0">Pick your plant</h3>
      <div class="grid" id="plantList">
        <!-- buttons injected by JS -->
      </div>
      <div class="card" style="margin-top:14px">
        <h3>Quick tip</h3>
        <p class="hint">Track each step. When a plant hits Level 5, you'll see a celebration and the value you grew.</p>
      </div>
    </aside>

    <!-- RIGHT: Content -->
    <section class="panel content">
      <div class="title-row">
        <h2 id="plantTitle">Plant</h2>
        <span class="tag" id="levelTag">Level 1: Seed</span>
      </div>

      <div class="timeline" id="timeline">
        <!-- nodes injected -->
      </div>

      <div class="pricebox">
        <span class="muted tiny">Market value (editable):</span>
        <input type="number" id="priceInput" step="0.01" min="0" />
        <select id="unitInput">
          <option value="per head">per head</option>
          <option value="per bunch">per bunch</option>
          <option value="per kg">per kg</option>
        </select>
        <div class="muted tiny">Estimated yield:</div>
        <input type="number" id="yieldInput" step="0.1" min="0" />
        <select id="yieldUnit">
          <option value="heads">heads</option>
          <option value="bunches">bunches</option>
          <option value="kg">kg</option>
        </select>
        <div class="bignum" id="valueOut">$0.00</div>
      </div>

      <div class="row">
        <div class="card">
          <h3>Step-by-step path</h3>
          <div class="steps" id="steps">
            <!-- steps injected -->
          </div>
        </div>
        <div class="card">
          <h3>Care snapshots</h3>
          <div id="careBox">
            <!-- care bullets injected -->
          </div>
          <hr style="border:0;border-top:1px solid rgba(255,255,255,.08);margin:12px 0" />
          <h3>Integrated pest management</h3>
          <ul class="ipm" id="ipm">
            <!-- ipm list injected -->
          </ul>
          <p class="hint">If chemical controls are legally permitted where you live, always follow label directions and local guidelines. Prefer non-chemical methods first and rotate crops to reduce pressure.</p>
        </div>
      </div>

      <div class="actions" style="margin-top:12px">
        <button class="btn" id="advance">Advance to next level</button>
        <button class="btn secondary" id="markAll">Mark all steps complete</button>
        <button class="btn danger" id="resetPlant">Reset this plant</button>
        <span class="hint" id="progressHint">0/5 steps complete</span>
      </div>

      <div class="footer">
        Designed as a single-file, interactive guide. Your progress is saved in your browser.
      </div>
    </section>
  </main>

  <div class="confetti" id="confetti"></div>

  <script>
    // Data model (concise, gamified, safe)
    const PLANTS = {
      potatoes: {
        name: "Potatoes",
        emoji: "ðŸ¥”",
        defaultPrice: 3.00,
        defaultUnit: "per kg",
        defaultYield: 2.0,
        defaultYieldUnit: "kg",
        care: [
          {label:"Sun", text:"Full sun (6â€“8h)"},
          {label:"Soil", text:"Loose, fertile, drains well; pH 5.8â€“6.5"},
          {label:"Water", text:"~2.5 cm/week; steady moisture during bulking"},
          {label:"Nutrition", text:"Compost at planting; light side-dress mid-season"},
          {label:"Bed", text:"Hilled rows or mounds 20â€“25 cm high"}
        ],
        ipm: [
          "Scout weekly; remove damaged foliage and hand-pick beetles/larvae.",
          "Mulch to buffer soil moisture and reduce splash-borne disease.",
          "Rotate nightshades (avoid planting in same bed within 3 years).",
          "Space plants and water at soil level for good airflow.",
          "For severe outbreaks, consult local guidance for approved controls."
        ],
        steps: [
          {title:"Seed prep", body:"Use certified seed tubers. Cut large ones into chunks with 1â€“2 eyes; cure 1â€“2 days."},
          {title:"Plant & mound", body:"Plant 8â€“10 cm deep, eyes up; 30 cm apart. Form mounds, 75 cm between rows."},
          {title:"Hill & weed", body:"Hill when stems reach ~15 cm; repeat at ~30 cm. Hand-weed weekly."},
          {title:"Even moisture", body:"Keep soil evenly moist. Avoid water stress during tuber bulking."},
          {title:"Harvest & cure", body:"Lift new potatoes early; for storage, wait till tops die back, then cure in cool dark."}
        ]
      },
      cauliflower: {
        name: "Cauliflower",
        emoji: "ðŸ¥¦", // close enough icon
        defaultPrice: 3.50,
        defaultUnit: "per head",
        defaultYield: 1,
        defaultYieldUnit: "heads",
        care: [
          {label:"Sun", text:"Full sun; steady cool temps preferred"},
          {label:"Soil", text:"Rich, well-drained; pH 6.2â€“7.0"},
          {label:"Water", text:"Consistent moisture; avoid stress to prevent buttoning"},
          {label:"Nutrition", text:"Balanced feeding; side-dress mid-season"},
          {label:"Tip", text:"Blanch by tying outer leaves over curd"}
        ],
        ipm: [
          "Row covers to exclude caterpillars early.",
          "Hand-pick caterpillars; encourage birds/beneficials.",
          "Remove debris; rotate brassicas every 2â€“3 years.",
          "Water at soil level; increase airflow.",
          "Seek local-approved controls only if needed."
        ],
        steps: [
          {title:"Start & harden", body:"Start seedlings; harden off 7 days."},
          {title:"Transplant", body:"Space ~45 Ã— 45 cm; water in well."},
          {title:"Feed & mulch", body:"Side-dress; mulch to keep roots cool."},
          {title:"Blanching", body:"When heads 7â€“10 cm, tie leaves to cover curd."},
          {title:"Harvest", body:"Cut firm, full-size heads before loosening."}
        ]
      },
      broccoli: {
        name: "Broccoli",
        emoji: "ðŸ¥¦",
        defaultPrice: 2.50,
        defaultUnit: "per head",
        defaultYield: 1.4,
        defaultYieldUnit: "heads",
        care: [
          {label:"Sun", text:"6â€“8h/day"},
          {label:"Soil", text:"Fertile, pH 6.2â€“7.0"},
          {label:"Water", text:"2â€“3 cm/week; steady moisture"},
          {label:"Nutrition", text:"Nitrogen-forward feeding in cool growth"},
          {label:"Tip", text:"After main head, harvest side shoots for weeks"}
        ],
        ipm: [
          "Use floating row covers to limit flea beetles/caterpillars.",
          "Hand-pick larvae; inspect undersides of leaves.",
          "Keep spacing generous; water at soil level.",
          "Rotate brassicas; clear residues post-harvest.",
          "Consult local, label-approved controls only if necessary."
        ],
        steps: [
          {title:"Seed or seedlings", body:"Start indoors or direct-sow in cool weather."},
          {title:"Transplant & space", body:"~50 Ã— 50 cm, firm soil, water in."},
          {title:"Feed & mulch", body:"Side-dress and mulch to hold moisture."},
          {title:"Main head timing", body:"Cut when tight buds; morning harvest."},
          {title:"Side shoots", body:"Keep picking side shoots to extend yield."}
        ]
      },
      radish: {
        name: "Radish",
        emoji: "ðŸ¥—",
        defaultPrice: 1.50,
        defaultUnit: "per bunch",
        defaultYield: 2,
        defaultYieldUnit: "bunches",
        care: [
          {label:"Sun", text:"Sun to part shade"},
          {label:"Soil", text:"Fine tilth; stones removed"},
          {label:"Water", text:"Even moisture to prevent pithiness"},
          {label:"Spacing", text:"Thin promptly to 5 cm"},
          {label:"Speed", text:"Ready in ~25â€“35 days"}
        ],
        ipm: [
          "Use row covers to block root maggot flies.",
          "Thin early; remove stressed plants.",
          "Rotate with non-brassicas.",
          "Water consistently; avoid overwatering before harvest.",
          "Consult local guidance if pressure persists."
        ],
        steps: [
          {title:"Prepare seedbed", body:"Rake to fine tilth; moisten soil."},
          {title:"Sow shallow", body:"1 cm deep, rows ~15 cm apart."},
          {title:"Thin seedlings", body:"Thin to ~5 cm to size up roots."},
          {title:"Keep moist", body:"Steady moisture for crisp roots."},
          {title:"Harvest", body:"Pull at 2â€“3 cm diameter before pithy."}
        ]
      },
      lettuce: {
        name: "Lettuce",
        emoji: "ðŸ¥¬",
        defaultPrice: 2.00,
        defaultUnit: "per head",
        defaultYield: 3,
        defaultYieldUnit: "heads",
        care: [
          {label:"Sun", text:"Cool sun; partial shade in heat"},
          {label:"Soil", text:"Rich, loose; plenty of organic matter"},
          {label:"Water", text:"Keep consistently moist; shallow roots"},
          {label:"Bolting", text:"Provide shade/choose slow-bolt varieties"},
          {label:"Harvest", text:"Cut heads or pick outer leaves"}
        ],
        ipm: [
          "Water mornings; avoid wet foliage overnight.",
          "Hand-pick slugs; use barriers and habitat management.",
          "Encourage beneficial insects; avoid overfertilizing.",
          "Rotate; remove debris promptly.",
          "Consult local-approved options only if needed."
        ],
        steps: [
          {title:"Sow or transplant", body:"Direct-seed or set seedlings in cool conditions."},
          {title:"Space & mulch", body:"~20 Ã— 20 cm; mulch to keep soil cool."},
          {title:"Moisture", body:"Even watering to avoid bitterness."},
          {title:"Leaf harvest", body:"Harvest outer leaves as they mature."},
          {title:"Head harvest", body:"Cut entire heads when firm and full."}
        ]
      }
    };

    // UI elements
    const plantList = document.getElementById('plantList');
    const plantTitle = document.getElementById('plantTitle');
    const levelTag = document.getElementById('levelTag');
    const stepsEl = document.getElementById('steps');
    const careBox = document.getElementById('careBox');
    const ipmBox = document.getElementById('ipm');
    const priceInput = document.getElementById('priceInput');
    const unitInput = document.getElementById('unitInput');
    const yieldInput = document.getElementById('yieldInput');
    const yieldUnit = document.getElementById('yieldUnit');
    const valueOut = document.getElementById('valueOut');
    const timeline = document.getElementById('timeline');
    const advanceBtn = document.getElementById('advance');
    const markAllBtn = document.getElementById('markAll');
    const resetPlantBtn = document.getElementById('resetPlant');
    const resetAllBtn = document.getElementById('resetAll');
    const progressHint = document.getElementById('progressHint');
    const toggleAdvanced = document.getElementById('toggleAdvanced');
    const overallBar = document.getElementById('overallBar');
    const overallLevels = document.getElementById('overallLevels');
    const confetti = document.getElementById('confetti');

    // State
    let currentKey = 'potatoes';
    const LS_KEY = 'grow-mastery-v1';
    let state = loadState();

    function defaultPlantState(key){
      const p = PLANTS[key];
      return {
        level: 1,
        steps: Array(p.steps.length).fill(false),
        price: p.defaultPrice,
        unit: p.defaultUnit,
        yld: p.defaultYield,
        yUnit: p.defaultYieldUnit
      };
    }

    function loadState(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        const obj = raw ? JSON.parse(raw) : {};
        for(const k of Object.keys(PLANTS)){
          if(!obj[k]) obj[k] = defaultPlantState(k);
        }
        return obj;
      }catch(e){
        const obj = {};
        for(const k of Object.keys(PLANTS)) obj[k] = defaultPlantState(k);
        return obj;
      }
    }
    function saveState(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }

    // Build plant selector
    function buildSidebar(){
      plantList.innerHTML = '';
      Object.entries(PLANTS).forEach(([key, p])=>{
        const b = document.createElement('button');
        b.className = 'plant-btn' + (key===currentKey?' active':'');
        b.innerHTML = `<span class="emoji">${p.emoji}</span>
                       <div style="text-align:left; color:var(--ink);">
                         <div style="font-weight:700;">${p.name}</div>
                         <div class="tiny muted">Level ${state[key].level} â€¢ ${countDone(key)}/${p.steps.length} steps</div>
                       </div>`;
        b.addEventListener('click', ()=>{ currentKey = key; render(); });
        plantList.appendChild(b);
      });
    }

    function countDone(key){
      return state[key].steps.filter(Boolean).length;
    }

    function levelFromSteps(key){
      const done = countDone(key);
      // 5 steps = 5 levels (1 per step)
      return Math.min(5, Math.max(1, done + 1));
    }

    function updateOverall(){
      const keys = Object.keys(PLANTS);
      const totalLevels = keys.reduce((acc,k)=> acc + state[k].level, 0);
      const pct = (totalLevels - keys.length) / (4*keys.length); // 1..5 -> 0..1
      overallBar.style.width = (pct*100).toFixed(1) + '%';

      // Highlight overall levels roughly by average
      const avgLevel = Math.round(totalLevels / keys.length);
      [...overallLevels.children].forEach((pill,i)=>{
        pill.classList.toggle('active', (i+1)<=avgLevel);
      });
    }

    function render(){
      buildSidebar();
      const p = PLANTS[currentKey];
      const ps = state[currentKey];
      plantTitle.textContent = `${p.emoji} ${p.name}`;
      // timeline
      timeline.innerHTML = '';
      const labels = ["Seed","Establish","Grow","Bulk/Head","Harvest"];
      for(let i=0;i<5;i++){
        const d = document.createElement('div');
        d.className = 'node' + ((i+1)<=ps.level ? ' active':'');
        d.innerHTML = `<div style="font-weight:700">Level ${i+1}</div><div class="tiny muted">${labels[i]}</div>`;
        timeline.appendChild(d);
      }
      // steps accordion
      stepsEl.innerHTML = '';
      p.steps.forEach((s, idx)=>{
        const done = ps.steps[idx];
        const details = document.createElement('details');
        details.open = idx===0;
        const check = done ? 'âœ…' : 'ðŸ”²';
        details.innerHTML = `
          <summary>
            <div class="step-title">
              <span>${check}</span>
              <strong>${idx+1}. ${s.title}</strong>
              <span class="chip tiny muted">Level ${idx+1}</span>
            </div>
            <span class="tiny ${done?'good':'muted'}">${done?'Done':'To do'}</span>
          </summary>
          <div style="padding: 0 14px 12px 14px; color: var(--ink)">${s.body}</div>
          <div class="actions">
            <button class="btn" data-action="toggle" data-idx="${idx}">${done?'Mark not done':'Mark done'}</button>
          </div>
        `;
        details.addEventListener('click', (e)=>{
          const btn = e.target.closest('button[data-action="toggle"]');
          if(btn){
            e.preventDefault();
            const i = +btn.dataset.idx;
            ps.steps[i] = !ps.steps[i];
            ps.level = levelFromSteps(currentKey);
            saveState(); render(); celebrateIfMax();
          }
        });
        stepsEl.appendChild(details);
      });
      // care
      careBox.innerHTML = '';
      p.care.forEach(c=>{
        const row = document.createElement('div');
        row.style.marginBottom = '6px';
        row.innerHTML = `<span class="chip">${c.label}</span> <span class="muted">â€¢</span> ${c.text}`;
        careBox.appendChild(row);
      });
      // ipm
      ipmBox.innerHTML = '';
      p.ipm.forEach(txt=>{
        const li = document.createElement('li');
        li.textContent = txt;
        ipmBox.appendChild(li);
      });
      // price/yield
      priceInput.value = ps.price;
      unitInput.value = ps.unit;
      yieldInput.value = ps.yld;
      yieldUnit.value = ps.yUnit;
      updateValue();
      // labels
      const lvl = ps.level;
      const tagLabel = ["Seed","Establish","Grow","Bulk/Head","Harvest"][lvl-1];
      levelTag.textContent = `Level ${lvl}: ${tagLabel}`;
      // buttons
      advanceBtn.disabled = (lvl>=5);
      progressHint.textContent = `${countDone(currentKey)}/${p.steps.length} steps complete`;
      updateOverall();
    }

    function updateValue(){
      const ps = state[currentKey];
      const price = parseFloat(priceInput.value||0);
      const qty = parseFloat(yieldInput.value||0);
      const val = Math.max(0, price*qty);
      valueOut.textContent = isFinite(val) ? '$' + val.toFixed(2) : '$0.00';
      // Persist units and numbers
      ps.price = price;
      ps.unit = unitInput.value;
      ps.yld = qty;
      ps.yUnit = yieldUnit.value;
      saveState();
    }

    // Simple confetti
    function celebrate(){
      const colors = ['#22d3ee','#a78bfa','#34d399','#f472b6','#f59e0b'];
      for(let i=0;i<60;i++){
        const s = document.createElement('div');
        s.className='piece';
        s.style.left = Math.random()*100+'vw';
        s.style.background = colors[Math.floor(Math.random()*colors.length)];
        s.style.transform = `rotate(${Math.random()*360}deg)`;
        s.style.animationDuration = (800 + Math.random()*800)+'ms';
        confetti.appendChild(s);
        setTimeout(()=> s.remove(), 1600);
      }
    }
    function celebrateIfMax(){
      const ps = state[currentKey];
      if(ps.level===5 && countDone(currentKey)===PLANTS[currentKey].steps.length){
        celebrate();
      }
    }

    // Events
    [priceInput, unitInput, yieldInput, yieldUnit].forEach(el=> el.addEventListener('input', updateValue));
    advanceBtn.addEventListener('click', ()=>{
      const ps = state[currentKey];
      if(ps.level<5){ ps.level++; saveState(); render(); if(ps.level===5) celebrate(); }
    });
    markAllBtn.addEventListener('click', ()=>{
      const ps = state[currentKey];
      ps.steps = ps.steps.map(()=>true);
      ps.level = 5;
      saveState(); render(); celebrate();
    });
    resetPlantBtn.addEventListener('click', ()=>{
      if(!confirm('Reset progress for this plant?')) return;
      state[currentKey] = defaultPlantState(currentKey);
      saveState(); render();
    });
    resetAllBtn.addEventListener('click', ()=>{
      if(!confirm('Reset all plants and values?')) return;
      for(const k of Object.keys(PLANTS)) state[k] = defaultPlantState(k);
      saveState(); render();
    });
    toggleAdvanced.addEventListener('change', ()=>{
      document.body.classList.toggle('advanced', toggleAdvanced.checked);
      // Placeholder for future: reveal extra pro tips if needed
    });

    // Initialize
    (function init(){
      // Build initial sidebar buttons
      buildSidebar();
      // Set defaults for units to match plants
      render();
    })();
  </script>
</body>
</html>
